{% extends "base.html" %}
{% block title %}My Orders{% endblock %}

{% block content %}
<div class="container py-5 text-white">

  <!-- Header -->
  <div class="mx-auto mb-4 p-4 rounded bg-dark text-white shadow-sm text-center w-100"
       style="max-width: 900px; border: 1px solid #6c757d;">
    <h2 class="mb-0">My Orders</h2>
  </div>

  {% if orders %}
    <ul class="list-group w-100 mx-auto" style="max-width: 900px;">
      {% for order in orders %}
        <li class="list-group-item bg-dark text-white d-flex justify-content-between align-items-center
                   shadow-sm mb-3 rounded p-3 border border-secondary">
          <div>
            <strong>Order #{{ order.id }}</strong><br>
            <small>Placed: {{ order.created_at|date:"Y-m-d H:i" }}</small><br>
            <strong>Status:</strong>
            <span class="{% if order.is_completed %}text-success{% else %}text-warning{% endif %}"
                  data-bs-toggle="tooltip" data-bs-placement="top"
                  title="{% if order.is_completed %}Your order has been completed and shipped.{% else %}Usually takes 1–3 days to ship. We’ll notify you once it’s sent.{% endif %}">
              {% if order.is_completed %}Completed{% else %}Pending{% endif %}
            </span>
            &nbsp;|&nbsp;
            <strong>Total:</strong> £{{ order.total_price }}
            <div class="mt-2">
              {% for item in order.items.all|slice:":3" %}
                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}"
                     class="img-thumbnail me-1" style="width: 40px; height: 40px; object-fit: cover;">
              {% endfor %}
              {% if order.items.count > 3 %}…{% endif %}
            </div>
          </div>
          <a href="{% url 'order_detail' order.id %}" class="btn btn-outline-light btn-sm">View Details</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="alert alert-info mt-3 w-100 mx-auto border border-secondary"
         style="max-width: 900px;">
      You haven't placed any orders yet.
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
      new bootstrap.Tooltip(el);
    });
  });
</script>
{% endblock %}
